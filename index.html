<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Pantry</title>
<style>
body {
  font-family: Arial, sans-serif; margin: 0; display: flex; height: 100vh; background: #f4f4f9; overflow: hidden;
  transition: background 0.3s, color 0.3s;
}
/* Dark mode */
body.dark { background: #121212; color: #fff; }
body.dark .sidebar, body.dark .section { background: #1e1e1e; color: #fff; border-color: #333; }
body.dark input, body.dark textarea { background: #2a2a2a; color: #fff; border-color: #555; }
/* Sidebar */
.sidebar { width: 200px; background: #fff; border-right: 1px solid #ccc; display: flex; flex-direction: column; padding: 10px; overflow-y: auto; }
.sidebar h2 { cursor: pointer; margin: 10px 0; font-size: 16px; display: flex; justify-content: space-between; }
.sidebarContent { margin-left: 5px; margin-bottom: 10px; }
.collapsed { display: none; }
/* Main content */
.main { flex: 1; padding: 20px; overflow-y: auto; }
h1 { text-align: center; margin-bottom: 20px; color: #333; }
body.dark h1 { color: #fff; }
/* Sections */
.section { background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
body.dark .section { background: #1e1e1e; box-shadow: 0 2px 5px rgba(255,255,255,0.05); }
.section h2 { cursor: pointer; display: flex; justify-content: space-between; margin: 0; font-size: 16px; }
.content { margin-top: 10px; display: block; transition: max-height 0.3s ease; overflow: hidden; }
/* Inputs */
input, textarea, button { padding: 8px; margin: 5px 0; width: 95%; box-sizing: border-box; border-radius: 5px; border: 1px solid #ccc; }
button { cursor: pointer; background: #4CAF50; color: white; border: none; transition: 0.2s; }
button:hover { background: #45a049; }
/* Ingredients / Recipes */
.ingredient, .recipe, .recipeItem { padding: 5px; border-bottom: 1px solid #ccc; display: flex; justify-content: space-between; align-items: center; border-radius: 5px; margin: 3px 0; }
.remove { color: red; cursor: pointer; margin-left: 10px; }
.instructions { margin-left: 20px; font-style: italic; color: #555; display: none; }
.quantity { font-weight: bold; margin-left: 5px; }
.camera-icon { cursor: pointer; font-size: 18px; margin-left: 5px; color: #4CAF50; }
body.dark .camera-icon { color: #80e27e; }
</style>
</head>
<body>

<!-- Dark mode toggle -->
<div style="position:absolute; top:10px; right:20px; z-index:1000;">
  <button onclick="toggleDark()">ðŸŒ™ Dark Mode</button>
</div>

<!-- Sidebar -->
<div class="sidebar">
  <h2 onclick="toggleSidebarContent('pantrySidebar')">Pantry â–¼</h2>
  <div id="pantrySidebar" class="sidebarContent"></div>
  <h2 onclick="toggleSidebarContent('recipesSidebar')">Recipes â–¼</h2>
  <div id="recipesSidebar" class="sidebarContent"></div>
</div>

<!-- Main content -->
<div class="main">
<h1>Smart Pantry</h1>

<div class="section">
  <h2 onclick="toggleSection('ingredientSection')">Add Ingredient â–¼</h2>
  <div class="content" id="ingredientSection">
    <input type="text" id="ingredientInput" placeholder="Ingredient name">
    <input type="text" id="ingredientQty" placeholder="Quantity (e.g., 2 cups, 1 loaf)">
    <span class="camera-icon" title="Upload Image ðŸ“·" onclick="document.getElementById('imageUpload').click()">ðŸ“·</span>
    <input type="file" id="imageUpload" accept="image/*" style="display:none" onchange="handleImage(event)">
    <button onclick="addIngredient()">Add</button>
  </div>
</div>

<div class="section">
  <h2 onclick="toggleSection('pantrySection')">Pantry â–¼</h2>
  <div class="content" id="pantrySection"><div id="ingredientList"></div></div>
</div>

<div class="section">
  <h2 onclick="toggleSection('addRecipeSection')">Add Recipe â–¼</h2>
  <div class="content" id="addRecipeSection">
    <input type="text" id="recipeName" placeholder="Recipe name">
    <input type="text" id="recipeIngredients" placeholder="Ingredients (comma-separated, e.g., cheddar:1 cup, milk:2 cups)">
    <textarea id="recipeInstructions" placeholder="Instructions"></textarea>
    <button onclick="addRecipe()">Add Recipe</button>
  </div>
</div>

<div class="section">
  <h2 onclick="toggleSection('recipeSuggestions')">Recipe Suggestions â–¼</h2>
  <div class="content" id="recipeSuggestions"><div id="recipeList"></div></div>
</div>

</div>

<!-- TensorFlow.js -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0/dist/mobilenet.min.js"></script>

<script>
// Collapsible sections
function toggleSection(id){ const sec=document.getElementById(id); sec.style.display=(sec.style.display==="none"?"block":"none"); }
function toggleSidebarContent(id){ const sec=document.getElementById(id); sec.style.display=(sec.style.display==="none"?"block":"none"); }

// Dark mode
function toggleDark(){
  document.body.classList.toggle("dark");
}

// Pantry & Recipes
let pantry = JSON.parse(localStorage.getItem('pantry')) || [];
let recipes = JSON.parse(localStorage.getItem('recipes')) || [];

function normalizeIngredient(name){ return name.toLowerCase().trim(); }

function addIngredient(){
  const name=normalizeIngredient(document.getElementById("ingredientInput").value);
  const qty=document.getElementById("ingredientQty").value.trim()||"1 unit";
  if(!name) return;
  const existing=pantry.find(i=>i.name===name);
  if(existing) existing.qty=qty; else pantry.push({name,qty});
  localStorage.setItem('pantry',JSON.stringify(pantry));
  document.getElementById("ingredientInput").value="";
  document.getElementById("ingredientQty").value="";
  updatePantry(); updatePantrySidebar(); updateRecipes(); updateSidebarList();
}

function removeIngredient(name){ pantry=pantry.filter(i=>i.name!==name); localStorage.setItem('pantry',JSON.stringify(pantry)); updatePantry(); updatePantrySidebar(); updateRecipes(); }

function updatePantry(){
  const list=document.getElementById("ingredientList"); list.innerHTML="";
  pantry.forEach(item=>{
    const d=document.createElement("div");
    d.className="ingredient";
    d.innerHTML=`<span>${item.name} <span class="quantity">(${item.qty})</span></span>`;
    const r=document.createElement("span");
    r.className="remove"; r.textContent="âœ–"; r.onclick=()=>removeIngredient(item.name);
    d.appendChild(r); list.appendChild(d);
  });
}

function updatePantrySidebar(){
  const list=document.getElementById("pantrySidebar"); list.innerHTML="";
  pantry.forEach(item=>{ const d=document.createElement("div"); d.textContent=`${item.name} (${item.qty})`; list.appendChild(d); });
}

// Recipes (same as before, minimal changes)
function addRecipe(){ /* same recipe logic as before */ }
function updateRecipes(){ /* same recipe display logic as before */ }
function updateSidebarList(){ /* same sidebar update logic */ }

updatePantry(); updatePantrySidebar(); updateRecipes(); updateSidebarList();

// --- IMAGE RECOGNITION ---
let model;
async function loadModel(){ model = await mobilenet.load(); }
loadModel();

async function handleImage(event){
  const file = event.target.files[0]; if(!file) return;
  const img = document.createElement("img"); img.src = URL.createObjectURL(file);
  img.onload = async ()=>{
    const predictions = await model.classify(img);
    if(predictions.length>0) document.getElementById("ingredientInput").value = predictions[0].className.split(",")[0];
  }
}
</script>
</body>
</html>

