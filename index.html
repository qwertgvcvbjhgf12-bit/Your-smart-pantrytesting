<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Pantry</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0/dist/mobilenet.min.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  display: flex;
  height: 100vh;
  background: #f4f4f9;
  overflow: hidden;
  transition: background 0.3s, color 0.3s;
}
/* Dark mode */
body.dark {
  background: #121212;
  color: #fff;
}
/* Sidebar */
.sidebar { width: 200px; background: #fff; border-right: 1px solid #ccc; display: flex; flex-direction: column; padding: 10px; overflow-y: auto; transition: background 0.3s, color 0.3s; }
body.dark .sidebar { background: #1e1e1e; color: #fff; border-color: #333; }
.sidebar h2 { cursor: pointer; margin: 10px 0; font-size: 16px; display: flex; justify-content: space-between; }
.sidebarContent { margin-left: 5px; margin-bottom: 10px; }
.collapsed { display: none; }
/* Main content */
.main { flex: 1; padding: 20px; overflow-y: auto; transition: background 0.3s, color 0.3s; }
body.dark .main { background: #121212; color: #fff; }
h1 { text-align: center; margin-bottom: 20px; color: #333; }
body.dark h1 { color: #fff; }
/* Sections */
.section { background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: background 0.3s, color 0.3s; }
body.dark .section { background: #1e1e1e; color: #fff; box-shadow: 0 2px 5px rgba(255,255,255,0.05); }
.section h2 { cursor: pointer; display: flex; justify-content: space-between; margin: 0; font-size: 16px; }
.content { margin-top: 10px; display: block; transition: max-height 0.3s ease; overflow: hidden; }
/* Inputs */
input, textarea, button { padding: 8px; margin: 5px 0; width: 95%; box-sizing: border-box; border-radius: 5px; border: 1px solid #ccc; }
body.dark input, body.dark textarea { background: #2c2c2c; color: #fff; border-color: #555; }
button { cursor: pointer; background: #4CAF50; color: white; border: none; transition: 0.2s; }
button:hover { background: #45a049; }
/* Ingredients / Recipes */
.ingredient, .recipe, .recipeItem { padding: 5px; border-bottom: 1px solid #ccc; display: flex; justify-content: space-between; align-items: center; border-radius: 5px; margin: 3px 0; }
body.dark .ingredient, body.dark .recipe, body.dark .recipeItem { border-color: #555; }
.remove { color: red; cursor: pointer; margin-left: 10px; }
.instructions { margin-left: 20px; font-style: italic; color: #555; display: none; }
body.dark .instructions { color: #aaa; }
.quantity { font-weight: bold; margin-left: 5px; }
.camera-icon { cursor: pointer; margin-left: 5px; }
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <h2 onclick="toggleSidebarContent('pantrySidebar')">Pantry â–¼</h2>
  <div id="pantrySidebar" class="sidebarContent"></div>
  <h2 onclick="toggleSidebarContent('recipesSidebar')">Recipes â–¼</h2>
  <div id="recipesSidebar" class="sidebarContent"></div>
</div>

<!-- Main content -->
<div class="main">
  <h1>Smart Pantry <button onclick="toggleDarkMode()">ðŸŒ™</button></h1>

  <div class="section">
    <h2 onclick="toggleSection('ingredientSection')">Add Ingredient â–¼</h2>
    <div class="content" id="ingredientSection">
      <input type="text" id="ingredientInput" placeholder="Ingredient name">
      <input type="text" id="ingredientQty" placeholder="Quantity (e.g., 2 cups, 1 loaf)">
      <span class="camera-icon" onclick="document.getElementById('imageUpload').click()">ðŸ“·</span>
      <input type="file" id="imageUpload" accept="image/*" style="display:none" onchange="handleImage(event)">
      <button onclick="addIngredient()">Add</button>
    </div>
  </div>

  <div class="section">
    <h2 onclick="toggleSection('pantrySection')">Pantry â–¼</h2>
    <div class="content" id="pantrySection"><div id="ingredientList"></div></div>
  </div>

  <div class="section">
    <h2 onclick="toggleSection('addRecipeSection')">Add Recipe â–¼</h2>
    <div class="content" id="addRecipeSection">
      <input type="text" id="recipeName" placeholder="Recipe name">
      <input type="text" id="recipeIngredients" placeholder="Ingredients (comma-separated)">
      <textarea id="recipeInstructions" placeholder="Instructions"></textarea>
      <button onclick="addRecipe()">Add Recipe</button>
    </div>
  </div>

  <div class="section">
    <h2 onclick="toggleSection('recipeSuggestions')">Recipe Suggestions â–¼</h2>
    <div class="content" id="recipeSuggestions"><div id="recipeList"></div></div>
  </div>
</div>

<script>
// Dark Mode
function toggleDarkMode() {
  document.body.classList.toggle("dark");
  localStorage.setItem("dark", document.body.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true") document.body.classList.add("dark");

// Collapsible sections
function toggleSection(id){ const sec=document.getElementById(id); sec.style.display=(sec.style.display==="none"?"block":"none"); }
function toggleSidebarContent(id){ const sec=document.getElementById(id); sec.style.display=(sec.style.display==="none"?"block":"none"); }

// Pantry & Recipes
let pantry = JSON.parse(localStorage.getItem('pantry')) || [];
let recipes = JSON.parse(localStorage.getItem('recipes')) || [];
function savePantry(){ localStorage.setItem('pantry', JSON.stringify(pantry)); }
function saveRecipes(){ localStorage.setItem('recipes', JSON.stringify(recipes)); }

// Ingredient functions
function normalizeIngredient(name){ return name.toLowerCase().trim(); }
function addIngredient(){
  const name = normalizeIngredient(document.getElementById("ingredientInput").value);
  const qty = document.getElementById("ingredientQty").value || "1 unit";
  if(!name) return;
  const existing = pantry.find(i=>i.name===name);
  if(existing) existing.qty = qty; else pantry.push({name,qty});
  savePantry(); updatePantry(); updatePantrySidebar();
  document.getElementById("ingredientInput").value=""; document.getElementById("ingredientQty").value="";
}
function removeIngredient(name){ pantry = pantry.filter(i=>i.name!==name); savePantry(); updatePantry(); updatePantrySidebar(); }

function updatePantry(){
  const list=document.getElementById("ingredientList"); list.innerHTML="";
  pantry.forEach(item=>{
    const d=document.createElement("div"); d.className="ingredient";
    d.innerHTML=`<span>${item.name} <span class="quantity">(${item.qty})</span></span>`;
    const r=document.createElement("span"); r.className="remove"; r.textContent="âœ–"; r.onclick=()=>removeIngredient(item.name);
    d.appendChild(r); list.appendChild(d);
  });
}
function updatePantrySidebar(){
  const list=document.getElementById("pantrySidebar"); list.innerHTML="";
  pantry.forEach(item=>{
    const d=document.createElement("div"); d.className="ingredient"; d.textContent=`${item.name} (${item.qty})`; list.appendChild(d);
  });
}

// Recipes
function addRecipe(){
  const name=document.getElementById("recipeName").value.trim();
  const ingredients=document.getElementById("recipeIngredients").value.split(",").map(i=>({name:normalizeIngredient(i.trim()),qty:"1 unit"}));
  const instructions=document.getElementById("recipeInstructions").value.trim();
  if(!name) return;
  recipes.push({name,ingredients,instructions});
  saveRecipes(); updateRecipes(); updateSidebarRecipes();
  document.getElementById("recipeName").value=""; document.getElementById("recipeIngredients").value=""; document.getElementById("recipeInstructions").value="";
}
function deleteRecipe(index){ recipes.splice(index,1); saveRecipes(); updateRecipes(); updateSidebarRecipes(); }
function updateRecipes(){
  const list=document.getElementById("recipeList"); list.innerHTML="";
  recipes.forEach(recipe=>{
    const missing = recipe.ingredients.filter(i=>!pantry.find(p=>p.name===i.name));
    const div=document.createElement("div"); div.className="recipe";
    div.textContent = recipe.name + (missing.length===0?" âœ…":" âŒ Missing: "+missing.map(m=>m.name).join(", "));
    list.appendChild(div);
  });
}
function updateSidebarRecipes(){
  const s=document.getElementById("recipesSidebar"); s.innerHTML="";
  recipes.forEach((r,i)=>{
    const d=document.createElement("div"); d.className="recipeItem"; d.textContent=r.name;
    const rem=document.createElement("span"); rem.className="remove"; rem.textContent="âœ–"; rem.onclick=()=>deleteRecipe(i);
    d.appendChild(rem); s.appendChild(d);
  });
}

// --- Image recognition ---
let model;
async function loadModel(){ model = await mobilenet.load(); }
loadModel();
async function handleImage(event){
  const file = event.target.files[0]; if(!file) return;
  const img = document.createElement("img"); img.src = URL.createObjectURL(file);
  img.onload = async ()=>{
    const predictions = await model.classify(img);
    if(predictions.length>0){
      document.getElementById("ingredientInput").value = predictions[0].className.split(",")[0].split(" ")[0];
    }
  }
}

// Init
updatePantry(); updatePantrySidebar(); updateRecipes(); updateSidebarRecipes();
</script>
</body>
</html>
