<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Smart Pantry Pro</title>
<link rel="icon" type="image/png" href="favicon.png">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Inter',sans-serif;
  background:#f4f6f8;
  margin:0;
}

header{
  background:#2e7d32;
  color:white;
  padding:20px;
  text-align:center;
}

.container{
  display:flex;
}

.sidebar{
  width:240px;
  background:#ffffff;
  padding:20px;
  border-right:1px solid #ddd;
  height:calc(100vh - 80px);
  overflow-y:auto;
}

.main{
  flex:1;
  padding:30px;
}

.card{
  background:white;
  padding:20px;
  border-radius:12px;
  box-shadow:0 6px 15px rgba(0,0,0,0.05);
  margin-bottom:20px;
}

button{
  background:#2e7d32;
  color:white;
  border:none;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}

button:hover{
  background:#256628;
}

input, textarea{
  padding:8px;
  margin:6px 0;
  width:100%;
}

.corrected{
  color:#2e7d32;
  font-weight:600;
}

.recipe-possible{
  border-left:6px solid #2e7d32;
  padding-left:10px;
  margin-bottom:10px;
}
</style>
</head>
<body>

<header>
<h1>ðŸ¥« Smart Pantry Pro</h1>
<p>AI-powered pantry & recipe intelligence</p>
</header>

<div class="container">

<div class="sidebar">
<h3>Recipes</h3>
<div id="recipeList"></div>
<hr>
<h4>Common Corrections</h4>
<div id="mistakes"></div>
</div>

<div class="main">

<div class="card">
<h3>Add Ingredient</h3>
<input id="ingredientInput" placeholder="e.g. 2 green onions chopped">
<input id="quantityInput" type="number" placeholder="Quantity">
<button onclick="addIngredient()">Add</button>
<div id="correctionNotice"></div>
</div>

<div class="card">
<h3>Pantry</h3>
<div id="pantryList"></div>
</div>

<div class="card">
<h3>Add Recipe</h3>
<input id="recipeName" placeholder="Recipe name">
<textarea id="recipeIngredients" placeholder="Ingredients separated by comma"></textarea>
<textarea id="recipeInstructions" placeholder="Instructions"></textarea>
<button onclick="addRecipe()">Add Recipe</button>
</div>

<div class="card">
<h3>Recipes You Can Make</h3>
<div id="availableRecipes"></div>
</div>

</div>
</div>

<script>

// ===== BASE FOOD DATABASE (~100+) =====
const baseFoods = [
"beef","chicken","pork","fish","shrimp","turkey","sausage","bacon",
"cheese","milk","butter","cream","yogurt","egg",
"bread","rice","pasta","flour","sugar","salt","pepper",
"onion","green onion","garlic","tomato","potato","carrot",
"broccoli","spinach","lettuce","cabbage","mushroom",
"zucchini","cucumber","pepper","corn","peas","green beans",
"asparagus","cauliflower","eggplant","radish","beet",
"pumpkin","squash","apple","banana","orange","strawberry",
"blueberry","raspberry","pineapple","mango","grape","pear",
"lemon","lime","avocado","cilantro","parsley","basil",
"oregano","thyme","rosemary","cumin","paprika",
"chili powder","soy sauce","ketchup","mustard","mayonnaise",
"honey","maple syrup","oats","almond","walnut","peanut",
"chocolate","vanilla","baking soda","baking powder",
"lentils","quinoa","barley","tofu","beans",
"black beans","kidney beans","pinto beans","hazelnut"
];

// ===== SPELL CORRECTION =====
function levenshtein(a,b){
 const matrix=[];
 for(let i=0;i<=b.length;i++) matrix[i]=[i];
 for(let j=0;j<=a.length;j++) matrix[0][j]=j;
 for(let i=1;i<=b.length;i++){
  for(let j=1;j<=a.length;j++){
   matrix[i][j]=b.charAt(i-1)===a.charAt(j-1)
   ?matrix[i-1][j-1]
   :Math.min(
     matrix[i-1][j-1]+1,
     matrix[i][j-1]+1,
     matrix[i-1][j]+1
   );
  }
 }
 return matrix[b.length][a.length];
}

// ===== DATA STORAGE =====
let pantry=JSON.parse(localStorage.getItem("pantry"))||{};
let recipes=JSON.parse(localStorage.getItem("recipes"))||[];
let mistakeLog=JSON.parse(localStorage.getItem("mistakes"))||{};

function save(){
 localStorage.setItem("pantry",JSON.stringify(pantry));
 localStorage.setItem("recipes",JSON.stringify(recipes));
 localStorage.setItem("mistakes",JSON.stringify(mistakeLog));
}

// ===== NORMALIZATION ENGINE =====
function normalizeIngredient(input){
 let original=input.toLowerCase().trim();

 // remove quantity words & descriptors
 original=original.replace(/\d+/g,"");
 original=original.replace(/chopped|sliced|diced|fresh|large|small/g,"").trim();

 // plural handling
 if(original.endsWith("es")) original=original.slice(0,-2);
 if(original.endsWith("s")) original=original.slice(0,-1);

 // exact
 if(baseFoods.includes(original)) return {final:original,changed:false};

 // partial match
 for(const food of baseFoods){
   if(original.includes(food)){
     logMistake(original,food);
     return {final:food,changed:true};
   }
 }

 // fuzzy match
 let closest=null;
 let smallest=999;
 for(const food of baseFoods){
   let dist=levenshtein(original,food);
   if(dist<smallest){
     smallest=dist;
     closest=food;
   }
 }

 if(smallest<=2){
   logMistake(original,closest);
   return {final:closest,changed:true};
 }

 return {final:original,changed:false};
}

// ===== MISTAKE TRACKING =====
function logMistake(from,to){
 if(from===to) return;
 if(!mistakeLog[from]) mistakeLog[from]=to;
}

// ===== ADD INGREDIENT =====
function addIngredient(){
 let input=document.getElementById("ingredientInput").value;
 let qty=parseInt(document.getElementById("quantityInput").value);
 if(!input||!qty) return;

 let result=normalizeIngredient(input);

 if(result.changed){
   if(!confirm(`Did you mean "${result.final}" instead of "${input}"?`)){
     return;
   }
 }

 if(pantry[result.final]){
   pantry[result.final]+=qty;
 }else{
   pantry[result.final]=qty;
 }

 document.getElementById("correctionNotice").innerHTML =
 result.changed?`Saved as <span class="corrected">${result.final}</span>`:"";

 save();
 renderAll();
}

// ===== ADD RECIPE =====
function addRecipe(){
 let name=document.getElementById("recipeName").value;
 let ingredients=document.getElementById("recipeIngredients").value.split(",");
 let instructions=document.getElementById("recipeInstructions").value;

 ingredients=ingredients.map(i=>normalizeIngredient(i.trim()).final);

 recipes.push({name,ingredients,instructions});
 save();
 renderAll();
}

// ===== RENDERING =====
function renderAll(){
 renderPantry();
 renderRecipes();
 renderAvailable();
 renderMistakes();
}

function renderPantry(){
 let div=document.getElementById("pantryList");
 div.innerHTML="";
 for(const item in pantry){
   div.innerHTML+=`${item}: ${pantry[item]}<br>`;
 }
}

function renderRecipes(){
 let div=document.getElementById("recipeList");
 div.innerHTML="";
 recipes.forEach((r,i)=>{
   div.innerHTML+=`<div onclick="viewRecipe(${i})">${r.name}</div><hr>`;
 });
}

function renderAvailable(){
 let div=document.getElementById("availableRecipes");
 div.innerHTML="";
 recipes.forEach(r=>{
   let possible=r.ingredients.every(i=>pantry[i]>0);
   if(possible){
     div.innerHTML+=`<div class="recipe-possible">${r.name}</div>`;
   }
 });
}

function renderMistakes(){
 let div=document.getElementById("mistakes");
 div.innerHTML="";
 for(const m in mistakeLog){
   div.innerHTML+=`${m} â†’ ${mistakeLog[m]}<br>`;
 }
}

function viewRecipe(i){
 alert(
   recipes[i].name+
   "\n\nIngredients:\n"+
   recipes[i].ingredients.join(", ")+
   "\n\nInstructions:\n"+
   recipes[i].instructions
 );
}

renderAll();

</script>
</body>
</html>

